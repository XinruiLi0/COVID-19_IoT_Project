@{
    ViewData["Title"] = "Doctor";
}

<script src="~/lib/jquery/dist/jquery.js"></script>
<script type="text/javascript">

    var userEmail;
    var userName;
    var userStatus;

    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) {
                    c_end = document.cookie.length;
                }
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }

    window.onload = function () {
        var getUserName = getCookie("username");
        $("#getUserName").html(getUserName);


        $('#searchBtn').click(function () {
            var getUserEmail = getCookie("userEmail");
            var getUserPassword = getCookie("userPassword");
            
            if ($('#searchBox').val() != '') {
                $.ajax({
                    type: "POST",
                    dataType: "text",
                    url: "/Home/checkPatientStatus",
                    data: { "userEmail": getUserEmail, "userPassword": getUserPassword, "visitorEmail": $('#searchBox').val() },
                    success: function (data) {
                        userName = JSON.parse(data).UserName;
                        userEmail = JSON.parse(data).UserEmail;
                        userStatus = JSON.parse(data).UserStatus;
                        $('#vistorName').html(userName);
                        $('#vistorEmail').html(userEmail);
                        if (userStatus == "0") {
                            $('#vistorHealthStatus').html("Healthy");
                        } else if (userStatus == "1"){
                            $('#vistorHealthStatus').html("Infected");
                        }




                    }
                });

            } else {
                $('#vistorName').html("");
                $('#vistorEmail').html("");
                $('#vistorHealthStatus').html("");
            }
        });
    }
    
    function healthy() {
        var getUserEmail = getCookie("userEmail");
        var getUserPassword = getCookie("userPassword");
        if (userName != "" && userEmail != "") {
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "/Home/updatePatientStatus",
                data: { "userEmail": getUserEmail, "userPassword": getUserPassword, "visitorEmail": userEmail, "status": 0 },
                success: function (data) {
                    alert(data);
                }
            });
        }
    }

    function infected() {
        var getUserEmail = getCookie("userEmail");
        var getUserPassword = getCookie("userPassword");
        if (userName != "" && userEmail != "") {
            $.ajax({
                type: "POST",
                dataType: "text",
                url: "/Home/updatePatientStatus",
                data: { "userEmail": getUserEmail, "userPassword": getUserPassword, "visitorEmail": userEmail, "status": 1 },
                success: function (data) {
                    alert(data);
                }
            });
        }
    }






</script>

<div class="page-content page-container" id="page-content">
    <div class="padding">
        <div class="row container d-flex justify-content-center">
            <div class="col-xl-6 col-md-12">
                <div class="card user-card-full">
                    <div class="row m-l-0 m-r-0">
                        <div class="col-sm-4 bg-c-lite-green user-profile">
                            <div class="card-block text-center text-white">
                                <div class="m-b-25"> <img src="~/doctor.jpg" class="img-radius" alt="Doctor" style="width:50%; height:50%; margin:auto;"> </div>
                                <h6 style="color:black" class="f-w-600">Doctor</h6>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="card-block">
                                <h6 class="m-b-20 p-b-5 b-b-default f-w-600">Information</h6>
                                <div class="row">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Dr.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <th id="getUserName"></th>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="PatientSearching">
    <p class="SearchingHint">Please input the name of the patient:</p>
    <form class="searching" >
        <input id="searchBox" type="text" placeholder="Search.." name="searchBox">
        <input id="searchBtn" type="button" class="fa fa-search" name ="searchBtn" value="Search"/>
    </form>
    <div id="result">
        <div>
            <h4 align ="center">Search Result</h4>
            <div class="table-responsive">
                <table class="table table table-bordered">
                    <thead>
                        <tr>
                            <th>Vistor Name</th>
                            <th>Vistor Email</th>
                            <th>Health Status</th>
                            <th>Option</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="vistorName"></td>
                            <td id="vistorEmail"></td>
                            <td id="vistorHealthStatus"></td>
                            <td id="option">
                                <input class="btn btn-info btn-lg" type="button" value="Healthy" onclick="healthy();" />
                                <input class="btn btn-info btn-lg" type="button" value="Infected" onclick="infected();"/>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div>
    <input class="btn btn-success btn-lg" type="button" value="Sign Out" onclick="location.href='@Url.Action("Login", "Login")'" />
</div>



